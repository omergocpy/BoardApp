{% extends 'base.html' %}
{% load static %}

{% block title %}
{{ user_detail.username }} - Profil Detayı
{% endblock %}

{% block content %}
<style>
  .progress {
    background-color: #f0f0f0;
    border-radius: 5px;
    height: 25px;
  }

  .progress-bar {
    background-color: #ff6700;
    transition: width 0.6s ease;
  }

  .text-muted {
    color: #bdbdbd;
  }

  .text-success {
    color: #4caf50;
  }
</style>

<div class="container mt-4">
  <!-- Kullanıcı Bilgileri -->
  <div class="card">
    <div class="card-body text-center">
      <img
        src="{% static 'images/avatar1.png' %}" 
        alt="Avatar" 
        class="rounded-circle mb-3" 
        width="100" 
        height="100"
      />
      <h5>{{ user_detail.username }}</h5>
      <p>ID: #{{ user_detail.id }}</p>
      <p>Level: {{ level }}</p>
      <p>Puan: {{ points }}</p>

      <!-- Progress Bar -->
      <div class="progress mt-3">
        <div
          class="progress-bar"
          role="progressbar"
          style="width: {{ progress_percentage }}%;"
          aria-valuenow="{{ progress_percentage }}"
          aria-valuemin="0"
          aria-valuemax="100"
        >
          Seviye {{ level }} (%{{ progress_percentage|floatformat:1 }})
        </div>
      </div>
    </div>
  </div>

  <!-- Kullanıcı Paylaşımları -->
  <div class="card mt-3">
    <div class="card-body">
      <h6>{{ user_detail.username }}'ın Paylaşımları</h6>
      {% for post in user_posts %}
        <div class="border rounded p-3 mb-3">
          <p><strong>{{ post.content|truncatewords:20 }}</strong></p>
          <small class="text-muted">Tarih: {{ post.created_at|date:"d M Y H:i" }}</small>
          {% if post.media_type == "image" %}
          <div class="mt-2">
            <img src="{{ post.media.url }}" alt="Post Media" class="img-fluid rounded">
          </div>
          {% elif post.media_type == "video" %}
          <div class="mt-2">
            <video controls class="img-fluid rounded">
              <source src="{{ post.media.url }}" type="video/mp4">
              Tarayıcınız bu videoyu desteklemiyor.
            </video>
          </div>
          {% endif %}
        </div>
      {% empty %}
        <p class="text-muted">Bu kullanıcı henüz bir paylaşım yapmamış.</p>
      {% endfor %}
    </div>
  </div>
  <!-- Pagination for Posts -->
  <nav aria-label="Posts Pagination" class="mt-3">
    <ul class="pagination justify-content-center">
      {% if user_posts.has_previous %}
        <li class="page-item"><a class="page-link" href="?page={{ user_posts.previous_page_number }}">Önceki</a></li>
      {% endif %}
      <li class="page-item active"><span class="page-link">{{ user_posts.number }}</span></li>
      {% if user_posts.has_next %}
        <li class="page-item"><a class="page-link" href="?page={{ user_posts.next_page_number }}">Sonraki</a></li>
      {% endif %}
    </ul>
  </nav>

  <!-- Kullanıcı Yorumları -->
  <div class="card mt-3">
    <div class="card-body">
      <h6>{{ user_detail.username }}'ın Yorumları</h6>
      {% for comment in user_comments %}
        <div class="border rounded p-3 mb-3">
          <p>{{ comment.content|truncatewords:20 }}</p>
          <small class="text-muted">Tarih: {{ comment.created_at|date:"d M Y H:i" }}</small>
        </div>
      {% empty %}
        <p class="text-muted">Bu kullanıcı henüz bir yorum yapmamış.</p>
      {% endfor %}
    </div>
  </div>
  <!-- Pagination for Comments -->
  <nav aria-label="Comments Pagination" class="mt-3">
    <ul class="pagination justify-content-center">
      {% if user_comments.has_previous %}
        <li class="page-item"><a class="page-link" href="?comment_page={{ user_comments.previous_page_number }}">Önceki</a></li>
      {% endif %}
      <li class="page-item active"><span class="page-link">{{ user_comments.number }}</span></li>
      {% if user_comments.has_next %}
        <li class="page-item"><a class="page-link" href="?comment_page={{ user_comments.next_page_number }}">Sonraki</a></li>
      {% endif %}
    </ul>
  </nav>
</div>
{% endblock %}
