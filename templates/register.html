{% extends 'base.html' %}
{% load static %}

{% block title %}
Kayıt Ol
{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="card">
        <div class="card-body">
            <div class="progress mb-4">
                <div id="progress-bar" class="progress-bar" role="progressbar" style="width: 16.6%;" aria-valuenow="16.6" aria-valuemin="0" aria-valuemax="100">Adım 1</div>
            </div>

            <form method="post">
                {% csrf_token %}
                
                <div id="step1" class="step active">
                    <h5 class="card-title text-center">Kayıt Kodu</h5>
                    <p class="text-center">Lütfen size verilen kayıt kodunu girin:</p>
                    {{ form.registration_code }}
                    {% if form.registration_code.errors %}
                        <div class="text-danger">{{ form.registration_code.errors }}</div>
                    {% endif %}
                    <button class="btn btn-primary btn-block" type="button" onclick="nextStep(2)">İleri</button>
                </div>

                <div id="step2" class="step">
                    <h5 class="card-title text-center">Kayıt Şifresi</h5>
                    <p class="text-center">Lütfen kayıt koduna bağlı şifreyi girin:</p>
                    {{ form.registration_password }}
                    {% if form.registration_password.errors %}
                        <div class="text-danger">{{ form.registration_password.errors }}</div>
                    {% endif %}
                    <button class="btn btn-primary btn-block" type="button" onclick="nextStep(3)">İleri</button>
                </div>

                <div id="step3" class="step">
                    <h5 class="card-title text-center">Cinsiyet Seçin</h5>
                    {{ form.gender }}
                    <button class="btn btn-primary btn-block" type="button" onclick="nextStep(4)">İleri</button>
                </div>

                <div id="step4" class="step">
                    <h5 class="card-title text-center">Avatar Seç</h5>
                    <div class="row text-center">
                        <div class="col-4 col-md-2 mb-3">
                            <img src="{% static 'images/avatar1.png' %}" class="profile-img" alt="avatar1.png" onclick="selectAvatar(this)">
                        </div>
                        <div class="col-4 col-md-2 mb-3">
                            <img src="{% static 'images/avatar2.png' %}" class="profile-img" alt="avatar2.png" onclick="selectAvatar(this)">
                        </div>
                        <div class="col-4 col-md-2 mb-3">
                            <img src="{% static 'images/avatar3.png' %}" class="profile-img" alt="avatar3.png" onclick="selectAvatar(this)">
                        </div>
                        <div class="col-4 col-md-2 mb-3">
                            <img src="{% static 'images/avatar4.png' %}" class="profile-img" alt="avatar4.png" onclick="selectAvatar(this)">
                        </div>
                        <div class="col-4 col-md-2 mb-3">
                            <img src="{% static 'images/avatar5.png' %}" class="profile-img" alt="avatar5.png" onclick="selectAvatar(this)">
                        </div>
                        <div class="col-4 col-md-2 mb-3">
                            <img src="{% static 'images/avatar6.png' %}" class="profile-img" alt="avatar6.png" onclick="selectAvatar(this)">
                        </div>
                        <div class="col-4 col-md-2 mb-3">
                            <img src="{% static 'images/avatar7.png' %}" class="profile-img" alt="avatar7.png" onclick="selectAvatar(this)">
                        </div>
                        <div class="col-4 col-md-2 mb-3">
                            <img src="{% static 'images/avatar8.png' %}" class="profile-img" alt="avatar8.png" onclick="selectAvatar(this)">
                        </div>
                        <div class="col-4 col-md-2 mb-3">
                            <img src="{% static 'images/avatar9.png' %}" class="profile-img" alt="avatar9.png" onclick="selectAvatar(this)">
                        </div>
                        <div class="col-4 col-md-2 mb-3">
                            <img src="{% static 'images/avatar10.png' %}" class="profile-img" alt="avatar10.png" onclick="selectAvatar(this)">
                        </div>
                    </div>
                    {{ form.avatar }}
                    <button class="btn btn-primary btn-block" type="button" onclick="nextStep(5)">İleri</button>
                </div>

                <div id="step5" class="step">
                    <h5 class="card-title text-center">Şifre Oluştur</h5>
                    {{ form.password1 }}
                    {% if form.password1.errors %}
                        <div class="text-danger">{{ form.password1.errors }}</div>
                    {% endif %}
                    {{ form.password2 }}
                    {% if form.password2.errors %}
                        <div class="text-danger">{{ form.password2.errors }}</div>
                    {% endif %}
                    <button class="btn btn-primary btn-block" type="button" onclick="nextStep(6)">İleri</button>
                </div>

                <!-- KVKK ve Onam Formu Adımı -->
                <div id="step6" class="step">
                    <h5 class="card-title text-center">KVKK ve Onam Formu</h5>
                    <div class="form-group">
                        <div class="card bg-light">
                            <div class="card-body" style="max-height: 300px; overflow-y: auto;">
                                <h6>Kişisel Verilerin Korunması Kanunu Kapsamında Aydınlatma Metni</h6>
                                <p>Aşağıda yer alan içerik, araştırma projemizin katılımcılarının haklarını korumak ve kişisel verilerinin işlenmesi konusunda bilgilendirilmesi amacıyla hazırlanmıştır.</p>
                                
                                <p>6698 sayılı Kişisel Verilerin Korunması Kanunu ("KVKK") kapsamında, kişisel verileriniz veri sorumlusu olarak [Araştırma Kurumu/Üniversite Adı] tarafından aşağıda açıklanan kapsamda işlenebilecektir.</p>
                                
                                <h6>Kişisel Verilerin İşlenme Amacı</h6>
                                <p>Bu araştırma projesi kapsamında toplanan kişisel verileriniz, bilimsel araştırma amacıyla ve sadece araştırma sonuçlarının değerlendirilmesi için kullanılacaktır. Verileriniz anonim hale getirilerek işlenecek ve araştırma sonuçları bilimsel yayınlarda kullanılabilecektir.</p>
                                
                                <h6>Kişisel Veri Toplama Yöntemi ve Hukuki Sebebi</h6>
                                <p>Kişisel verileriniz, bu araştırma platformu aracılığıyla elektronik ortamda toplanmaktadır. Verileriniz KVKK'nın 5. maddesinde belirtilen "açık rızanın alınması" hukuki sebebine dayanarak işlenmektedir.</p>
                                
                                <h6>Kişisel Verilerin Aktarılması</h6>
                                <p>Kişisel verileriniz, araştırma ekibi dışında üçüncü kişilerle paylaşılmayacaktır. Araştırma sonuçları bilimsel yayınlarda kullanılması durumunda, veriler anonim hale getirilerek sunulacaktır.</p>
                                
                                <h6>KVKK Kapsamındaki Haklarınız</h6>
                                <p>KVKK'nın 11. maddesi uyarınca, kişisel verilerinizle ilgili olarak aşağıdaki haklara sahipsiniz:</p>
                                <ul>
                                    <li>Kişisel verilerinizin işlenip işlenmediğini öğrenme,</li>
                                    <li>Kişisel verileriniz işlenmişse buna ilişkin bilgi talep etme,</li>
                                    <li>Kişisel verilerinizin işlenme amacını ve bunların amacına uygun kullanılıp kullanılmadığını öğrenme,</li>
                                    <li>Kişisel verilerinizin eksik veya yanlış işlenmiş olması hâlinde bunların düzeltilmesini isteme,</li>
                                    <li>Kişisel verilerinizin silinmesini veya yok edilmesini isteme,</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-check mt-3">
                        {{ form.agree_to_terms }}
                        <label class="form-check-label" for="{{ form.agree_to_terms.id_for_label }}">
                            {{ form.agree_to_terms.label }}
                        </label>
                        {% if form.agree_to_terms.errors %}
                            <div class="text-danger">{{ form.agree_to_terms.errors }}</div>
                        {% endif %}
                    </div>
                    
                    <button class="btn btn-success btn-block mt-3" type="submit">Tamamla</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    function nextStep(step) {
        var steps = document.querySelectorAll('.step');
        steps.forEach(function(stepElement) {
            stepElement.classList.remove('active');
        });
        document.getElementById('step' + step).classList.add('active');

        // İlerleme çubuğunu güncelle (şimdi 6 adım var)
        var stepPercentage = (step / 6) * 100;
        var progressBar = document.getElementById('progress-bar');
        progressBar.style.width = stepPercentage + '%';
        progressBar.setAttribute('aria-valuenow', stepPercentage);
        progressBar.textContent = 'Adım ' + step;
    }

    function selectAvatar(element) {
        var avatars = document.querySelectorAll('.profile-img');
        avatars.forEach(function(avatar) {
            avatar.classList.remove('selected');
        });
        element.classList.add('selected');

        // Seçilen avatarın dosya adını gizli input alanına kaydet
        document.getElementById('id_avatar').value = element.alt;
    }
</script>
<style>
    .btn-primary {
        background-color: #ff8200;
        border-color: #ff8200;
    }

    .step {
        display: none;
    }

    .step.active {
        display: block;
    }

    .code-input {
        font-size: 24px;
        letter-spacing: 10px;
        text-align: center;
    }

    .profile-img {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        margin: 10px auto;
        cursor: pointer;
    }

    .profile-img.selected {
        border: 2px solid #ff8200;
    }

    .progress-bar {
        background-color: #ff8200;
    }
</style>
{% endblock %}
