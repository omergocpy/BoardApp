{% extends 'base.html' %}
{% load static %}

{% block title %}
Kayıt Ol
{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="card">
        <div class="card-body">
            <!-- İlerleme Çubuğu -->
            <div class="progress mb-4">
                <div id="progress-bar" class="progress-bar" role="progressbar" style="width: 20%;" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100">Adım 1</div>
            </div>

            <form method="post">
                {% csrf_token %}
                
                <!-- Adımlar -->
                <div id="step1" class="step active">
                    <h5 class="card-title text-center">Kayıt Kodu</h5>
                    <p class="text-center">Lütfen size verilen kayıt kodunu girin:</p>
                    {{ form.registration_code }}
                    {% if form.registration_code.errors %}
                        <div class="text-danger">{{ form.registration_code.errors }}</div>
                    {% endif %}
                    <button class="btn btn-primary btn-block" type="button" onclick="nextStep(2)">İleri</button>
                </div>

                <div id="step2" class="step">
                    <h5 class="card-title text-center">Kayıt Şifresi</h5>
                    <p class="text-center">Lütfen kayıt koduna bağlı şifreyi girin:</p>
                    {{ form.registration_password }}
                    {% if form.registration_password.errors %}
                        <div class="text-danger">{{ form.registration_password.errors }}</div>
                    {% endif %}
                    <button class="btn btn-primary btn-block" type="button" onclick="nextStep(3)">İleri</button>
                </div>

                <div id="step3" class="step">
                    <h5 class="card-title text-center">Cinsiyet Seçin</h5>
                    {{ form.gender }}
                    <button class="btn btn-primary btn-block" type="button" onclick="nextStep(4)">İleri</button>
                </div>

                <div id="step4" class="step">
                    <h5 class="card-title text-center">Avatar Seç</h5>
                    <div class="row text-center">
                        <div class="col-6">
                            <img src="{% static 'images/avatar1.png' %}" class="profile-img" alt="avatar1.png" onclick="selectAvatar(this)">
                        </div>
                        <div class="col-6">
                            <img src="{% static 'images/avatar2.png' %}" class="profile-img" alt="avatar2.png" onclick="selectAvatar(this)">
                        </div>
                        <div class="col-6">
                            <img src="{% static 'images/avatar3.png' %}" class="profile-img" alt="avatar3.png" onclick="selectAvatar(this)">
                        </div>
                        <div class="col-6">
                            <img src="{% static 'images/avatar4.png' %}" class="profile-img" alt="avatar4.png" onclick="selectAvatar(this)">
                        </div>
                    </div>
                    {{ form.avatar }}
                    <button class="btn btn-primary btn-block" type="button" onclick="nextStep(5)">İleri</button>
                </div>

                <div id="step5" class="step">
                    <h5 class="card-title text-center">Şifre Oluştur</h5>
                    {{ form.password1 }}
                    {% if form.password1.errors %}
                        <div class="text-danger">{{ form.password1.errors }}</div>
                    {% endif %}
                    {{ form.password2 }}
                    {% if form.password2.errors %}
                        <div class="text-danger">{{ form.password2.errors }}</div>
                    {% endif %}
                    <button class="btn btn-success btn-block" type="submit">Tamamla</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    function nextStep(step) {
        var steps = document.querySelectorAll('.step');
        steps.forEach(function(stepElement) {
            stepElement.classList.remove('active');
        });
        document.getElementById('step' + step).classList.add('active');

        // İlerleme çubuğunu güncelle
        var progressBar = document.getElementById('progress-bar');
        var stepPercentage = (step / 5) * 100;
        progressBar.style.width = stepPercentage + '%';
        progressBar.setAttribute('aria-valuenow', stepPercentage);
        progressBar.textContent = 'Adım ' + step;
    }

    function selectAvatar(element) {
        var avatars = document.querySelectorAll('.profile-img');
        avatars.forEach(function(avatar) {
            avatar.classList.remove('selected');
        });
        element.classList.add('selected');

        // Seçilen avatarın dosya adını gizli input alanına kaydet
        document.getElementById('id_avatar').value = element.alt;
    }
</script>
<style>
    .btn-primary {
        background-color: #ff8200;
        border-color: #ff8200;
    }

    .step {
        display: none;
    }

    .step.active {
        display: block;
    }

    .code-input {
        font-size: 24px;
        letter-spacing: 10px;
        text-align: center;
    }

    .profile-img {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        margin: 10px auto;
        cursor: pointer;
    }

    .profile-img.selected {
        border: 2px solid #ff8200;
    }

    .progress-bar {
        background-color: #ff8200;
    }
</style>
{% endblock %}
