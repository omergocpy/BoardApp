{% extends 'base.html' %}
{% load static %}

{% block title %}Yeni Gönderi Oluştur{% endblock %}

{% block content %}
<style>
    .form-container {
        max-width: 700px;
        margin: 50px auto;
        background-color: #f9f9f9;
        padding: 20px;
        border-radius: 10px;
    }
    .post-type-options {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        justify-content: space-around;
        flex-wrap: wrap;
    }
    .post-type-option {
        text-align: center;
        padding: 10px;
        border-radius: 8px;
        background-color: #f0f0f0;
        border: 2px solid transparent;
        transition: transform 0.2s ease, background-color 0.3s ease;
        cursor: pointer;
        font-weight: bold;
        color: #555;
        width: 100px;
    }
    .post-type-option:hover {
        background-color: #007bff;
        color: #fff;
        transform: scale(1.05);
    }
    .post-type-option.disabled {
        background-color: #ddd;
        color: #999;
        cursor: not-allowed;
    }
    .post-type-option.active {
        background-color: #007bff;
        color: #fff;
    }
    .poll-options {
        display: none;
    }
</style>

<div class="form-container">
    <h2 class="mb-4 text-center">Yeni Gönderi Oluştur</h2>

    <!-- Gönderi Türü Seçenekleri -->
    <div class="post-type-options">
        <div class="post-type-option" id="pt-text" data-type="text">Metin</div>
        <div class="post-type-option {% if level < 3 %}disabled{% endif %}" id="pt-photo" data-type="photo">Fotoğraf</div>
        <div class="post-type-option {% if level < 4 %}disabled{% endif %}" id="pt-video" data-type="video">Video</div>
        <div class="post-type-option {% if level < 4 %}disabled{% endif %}" id="pt-poll" data-type="poll">Anket</div>
    </div>

    <form method="post" enctype="multipart/form-data" id="postForm">
        {% csrf_token %}
        
        <!-- Django form alanları -->
        <!-- post_type, content, media, is_bold, text_color, bg_color, option1..4 -->
        <div class="form-group" style="display:none;">
            {{ form.post_type }}
        </div>
        
        <div class="form-group">
            <label for="id_content">Gönderi İçeriği</label>
            {{ form.content }}
        </div>

        <!-- Stil alanları -->
        <div class="form-group">
            <div class="form-check">
                {{ form.is_bold }}
                <label class="form-check-label" for="id_is_bold">Kalın Yazı</label>
            </div>
        </div>
        <div class="form-row">
            <div class="form-group col-md-6">
                <label for="id_text_color">Yazı Rengi</label>
                {{ form.text_color }}
            </div>
            <div class="form-group col-md-6">
                <label for="id_bg_color">Arka Plan Rengi</label>
                {{ form.bg_color }}
            </div>
        </div>

        <!-- Medya -->
        <div class="form-group" id="media-group" style="display:none;">
            <label for="id_media">Medya Seç</label>
            {{ form.media }}
        </div>

        <!-- Anket Seçenekleri -->
        <div class="poll-options" id="poll-options">
            <label>Anket Seçenekleri (Boş bıraktıklarınız eklenmez)</label>
            <div class="form-group">
                {{ form.option1 }}
            </div>
            <div class="form-group">
                {{ form.option2 }}
            </div>
            <div class="form-group">
                {{ form.option3 }}
            </div>
            <div class="form-group">
                {{ form.option4 }}
            </div>
        </div>

        <button type="submit" class="btn btn-primary btn-block mt-4">Paylaş</button>
    </form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const postTypeSelect = document.getElementById('id_post_type');
        const textOption = document.getElementById('pt-text');
        const photoOption = document.getElementById('pt-photo');
        const videoOption = document.getElementById('pt-video');
        const pollOption = document.getElementById('pt-poll');

        const postTypeOptions = [textOption, photoOption, videoOption, pollOption];
        
        const mediaGroup = document.getElementById('media-group');
        const pollOptionsDiv = document.getElementById('poll-options');

        function setActiveOption(type) {
            postTypeOptions.forEach(opt => opt.classList.remove('active'));
            const activeOpt = postTypeOptions.find(opt => opt.dataset.type === type);
            if (activeOpt) {
                activeOpt.classList.add('active');
            }
        }

        // Başlangıçta varsayılan text
        postTypeSelect.value = 'text';
        setActiveOption('text');

        postTypeOptions.forEach(option => {
            option.addEventListener('click', function() {
                if (option.classList.contains('disabled')) {
                    alert("Bu türü kullanmak için yeterli seviyeniz yok!");
                    return;
                }
                const chosenType = option.dataset.type;
                postTypeSelect.value = chosenType;
                setActiveOption(chosenType);

                // Medya zorunlu mu vs. basit bir mantık
                if (chosenType === 'text') {
                    mediaGroup.style.display = 'none';
                    pollOptionsDiv.style.display = 'none';
                } else if (chosenType === 'photo' || chosenType === 'video') {
                    mediaGroup.style.display = 'block';
                    pollOptionsDiv.style.display = 'none';
                } else if (chosenType === 'poll') {
                    mediaGroup.style.display = 'none';
                    pollOptionsDiv.style.display = 'block';
                }
            });
        });
    });
</script>
{% endblock %}
